{"version":3,"sources":["../src/createTransportReplayer.js"],"names":["createTransportReplayer","recordStore","TransportReplayer","Transport","setScrambleKey","close","Promise","resolve","exchange","apdu","toString","buffer","replayExchange","e","String","reject","isSupported","list","listen","o","unsubscribed","setTimeout","next","type","descriptor","complete","unsubscribe","open"],"mappings":";;;;;;;AACA;;AACA;;;;AAGA;;;;AAIA,MAAMA,uBAAuB,GAC3BC,WAD8B,IAEN;AACxB,QAAMC,iBAAN,SAAgCC,oBAAhC,CAA6C;AAkB3CC,IAAAA,cAAc,GAAG,CAAE;;AAEnBC,IAAAA,KAAK,GAAG;AACN,aAAOC,OAAO,CAACC,OAAR,EAAP;AACD;;AAEDC,IAAAA,QAAQ,CAACC,IAAD,EAAgC;AACtC,qBAAI,MAAJ,EAAYA,IAAI,CAACC,QAAL,CAAc,KAAd,CAAZ;;AACA,UAAI;AACF,cAAMC,MAAM,GAAGV,WAAW,CAACW,cAAZ,CAA2BH,IAA3B,CAAf;AACA,uBAAI,MAAJ,EAAYE,MAAM,CAACD,QAAP,CAAgB,KAAhB,CAAZ;AACA,eAAOJ,OAAO,CAACC,OAAR,CAAgBI,MAAhB,CAAP;AACD,OAJD,CAIE,OAAOE,CAAP,EAAU;AACV,uBAAI,YAAJ,EAAkBC,MAAM,CAACD,CAAD,CAAxB;AACA,eAAOP,OAAO,CAACS,MAAR,CAAeF,CAAf,CAAP;AACD;AACF;;AAlC0C;;AAAvCX,EAAAA,iBADkB,CAEfc,WAFe,GAED,MAAMV,OAAO,CAACC,OAAR,CAAgB,IAAhB,CAFL;;AAClBL,EAAAA,iBADkB,CAGfe,IAHe,GAGR,MAAMX,OAAO,CAACC,OAAR,CAAgB,CAAC,IAAD,CAAhB,CAHE;;AAClBL,EAAAA,iBADkB,CAIfgB,MAJe,GAILC,CAAD,IAAO;AACrB,QAAIC,YAAJ;AACAC,IAAAA,UAAU,CAAC,MAAM;AACf,UAAID,YAAJ,EAAkB;AAClBD,MAAAA,CAAC,CAACG,IAAF,CAAO;AAAEC,QAAAA,IAAI,EAAE,KAAR;AAAeC,QAAAA,UAAU,EAAE;AAA3B,OAAP;AACAL,MAAAA,CAAC,CAACM,QAAF;AACD,KAJS,EAIP,CAJO,CAAV;AAKA,WAAO;AACLC,MAAAA,WAAW,EAAE,MAAM;AACjBN,QAAAA,YAAY,GAAG,IAAf;AACD;AAHI,KAAP;AAKD,GAhBqB;;AAClBlB,EAAAA,iBADkB,CAiBfyB,IAjBe,GAiBR,MAAMrB,OAAO,CAACC,OAAR,CAAgB,IAAIL,iBAAJ,EAAhB,CAjBE;;AAqCxB,SAAOA,iBAAP;AACD,CAxCD;;eA0CeF,uB","sourcesContent":["//@flow\nimport Transport from \"@ledgerhq/hw-transport\";\nimport { log } from \"@ledgerhq/logs\";\nimport type { RecordStore } from \"./RecordStore\";\n\n/**\n * create a transport replayer with a record store.\n * @param recordStore\n */\nconst createTransportReplayer = (\n  recordStore: RecordStore\n): Class<Transport<*>> => {\n  class TransportReplayer extends Transport<*> {\n    static isSupported = () => Promise.resolve(true);\n    static list = () => Promise.resolve([null]);\n    static listen = (o) => {\n      let unsubscribed;\n      setTimeout(() => {\n        if (unsubscribed) return;\n        o.next({ type: \"add\", descriptor: null });\n        o.complete();\n      }, 0);\n      return {\n        unsubscribe: () => {\n          unsubscribed = true;\n        },\n      };\n    };\n    static open = () => Promise.resolve(new TransportReplayer());\n\n    setScrambleKey() {}\n\n    close() {\n      return Promise.resolve();\n    }\n\n    exchange(apdu: Buffer): Promise<Buffer> {\n      log(\"apdu\", apdu.toString(\"hex\"));\n      try {\n        const buffer = recordStore.replayExchange(apdu);\n        log(\"apdu\", buffer.toString(\"hex\"));\n        return Promise.resolve(buffer);\n      } catch (e) {\n        log(\"apdu-error\", String(e));\n        return Promise.reject(e);\n      }\n    }\n  }\n  return TransportReplayer;\n};\n\nexport default createTransportReplayer;\n"],"file":"createTransportReplayer.js"}
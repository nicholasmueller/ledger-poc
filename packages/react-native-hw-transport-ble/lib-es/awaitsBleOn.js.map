{"version":3,"sources":["../src/awaitsBleOn.js"],"names":["BluetoothRequired","log","timer","awaitsBleOn","bleManager","ms","Promise","resolve","reject","done","lastState","stateSub","onStateChange","state","removeTimeout","remove","timeout"],"mappings":"AAEA,SAASA,iBAAT,QAAkC,kBAAlC;AACA,SAASC,GAAT,QAAoB,gBAApB;AACA,OAAOC,KAAP,MAAkB,SAAlB;AAGA,OAAO,MAAMC,WAAW,GAAG,CACzBC,UADyB,EAEzBC,EAAU,GAAG,IAFY,KAIzB,IAAIC,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;AAC/B,MAAIC,IAAI,GAAG,KAAX;AACA,MAAIC,SAAS,GAAG,SAAhB;AAEA,QAAMC,QAAQ,GAAGP,UAAU,CAACQ,aAAX,CAA0BC,KAAD,IAAW;AACnDH,IAAAA,SAAS,GAAGG,KAAZ;AACAZ,IAAAA,GAAG,CAAC,aAAD,EAAiB,gBAAeY,KAAM,EAAtC,CAAH;;AACA,QAAIA,KAAK,KAAK,WAAd,EAA2B;AACzB,UAAIJ,IAAJ,EAAU;AACVK,MAAAA,aAAa;AACbL,MAAAA,IAAI,GAAG,IAAP;AACAE,MAAAA,QAAQ,CAACI,MAAT;AACAR,MAAAA,OAAO;AACR;AACF,GAVgB,EAUd,IAVc,CAAjB;AAYA,QAAMO,aAAa,GAAGZ,KAAK,CAACc,OAAN,CAAc,MAAM;AACxC,QAAIP,IAAJ,EAAU;AACVE,IAAAA,QAAQ,CAACI,MAAT;AACAP,IAAAA,MAAM,CAAC,IAAIR,iBAAJ,CAAsB,EAAtB,EAA0B;AAAEa,MAAAA,KAAK,EAAEH;AAAT,KAA1B,CAAD,CAAN;AACD,GAJqB,EAInBL,EAJmB,CAAtB;AAKD,CArBD,CAJK","sourcesContent":["// @flow\n\nimport { BluetoothRequired } from \"@ledgerhq/errors\";\nimport { log } from \"@ledgerhq/logs\";\nimport timer from \"./timer\";\nimport type { BleManager } from \"./types\";\n\nexport const awaitsBleOn = (\n  bleManager: BleManager,\n  ms: number = 3000\n): Promise<void> =>\n  new Promise((resolve, reject) => {\n    let done = false;\n    let lastState = \"Unknown\";\n\n    const stateSub = bleManager.onStateChange((state) => {\n      lastState = state;\n      log(\"ble-verbose\", `ble state -> ${state}`);\n      if (state === \"PoweredOn\") {\n        if (done) return;\n        removeTimeout();\n        done = true;\n        stateSub.remove();\n        resolve();\n      }\n    }, true);\n\n    const removeTimeout = timer.timeout(() => {\n      if (done) return;\n      stateSub.remove();\n      reject(new BluetoothRequired(\"\", { state: lastState }));\n    }, ms);\n  });\n"],"file":"awaitsBleOn.js"}
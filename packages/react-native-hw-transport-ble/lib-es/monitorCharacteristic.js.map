{"version":3,"sources":["../src/monitorCharacteristic.js"],"names":["Observable","TransportError","log","monitorCharacteristic","characteristic","create","o","uuid","subscription","monitor","error","c","value","Buffer","from","next","remove"],"mappings":"AAEA,SAASA,UAAT,QAA2B,MAA3B;AACA,SAASC,cAAT,QAA+B,kBAA/B;AAEA,SAASC,GAAT,QAAoB,gBAApB;AAEA,OAAO,MAAMC,qBAAqB,GAChCC,cADmC,IAGnCJ,UAAU,CAACK,MAAX,CAAmBC,CAAD,IAAO;AACvBJ,EAAAA,GAAG,CAAC,aAAD,EAAgB,mBAAmBE,cAAc,CAACG,IAAlD,CAAH;AACA,QAAMC,YAAY,GAAGJ,cAAc,CAACK,OAAf,CAAuB,CAACC,KAAD,EAAQC,CAAR,KAAc;AACxD,QAAID,KAAJ,EAAW;AACTR,MAAAA,GAAG,CACD,aADC,EAED,mBAAmBE,cAAc,CAACG,IAAlC,GAAyC,IAAzC,GAAgDG,KAF/C,CAAH;AAIAJ,MAAAA,CAAC,CAACI,KAAF,CAAQA,KAAR;AACD,KAND,MAMO,IAAI,CAACC,CAAL,EAAQ;AACbL,MAAAA,CAAC,CAACI,KAAF,CACE,IAAIT,cAAJ,CACE,mCADF,EAEE,2BAFF,CADF;AAMD,KAPM,MAOA;AACL,UAAI;AACF,cAAMW,KAAK,GAAGC,MAAM,CAACC,IAAP,CAAYH,CAAC,CAACC,KAAd,EAAqB,QAArB,CAAd;AACAN,QAAAA,CAAC,CAACS,IAAF,CAAOH,KAAP;AACD,OAHD,CAGE,OAAOF,KAAP,EAAc;AACdJ,QAAAA,CAAC,CAACI,KAAF,CAAQA,KAAR;AACD;AACF;AACF,GAtBoB,CAArB;AAwBA,SAAO,MAAM;AACXR,IAAAA,GAAG,CAAC,aAAD,EAAgB,iBAAiBE,cAAc,CAACG,IAAhD,CAAH;AACAC,IAAAA,YAAY,CAACQ,MAAb;AACD,GAHD;AAID,CA9BD,CAHK","sourcesContent":["// @flow\n\nimport { Observable } from \"rxjs\";\nimport { TransportError } from \"@ledgerhq/errors\";\nimport type { Characteristic } from \"./types\";\nimport { log } from \"@ledgerhq/logs\";\n\nexport const monitorCharacteristic = (\n  characteristic: Characteristic\n): Observable<Buffer> =>\n  Observable.create((o) => {\n    log(\"ble-verbose\", \"start monitor \" + characteristic.uuid);\n    const subscription = characteristic.monitor((error, c) => {\n      if (error) {\n        log(\n          \"ble-verbose\",\n          \"error monitor \" + characteristic.uuid + \": \" + error\n        );\n        o.error(error);\n      } else if (!c) {\n        o.error(\n          new TransportError(\n            \"characteristic monitor null value\",\n            \"CharacteristicMonitorNull\"\n          )\n        );\n      } else {\n        try {\n          const value = Buffer.from(c.value, \"base64\");\n          o.next(value);\n        } catch (error) {\n          o.error(error);\n        }\n      }\n    });\n\n    return () => {\n      log(\"ble-verbose\", \"end monitor \" + characteristic.uuid);\n      subscription.remove();\n    };\n  });\n"],"file":"monitorCharacteristic.js"}
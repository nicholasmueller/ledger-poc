{"version":3,"sources":["../src/monitorCharacteristic.js"],"names":["monitorCharacteristic","characteristic","Observable","create","o","uuid","subscription","monitor","error","c","TransportError","value","Buffer","from","next","remove"],"mappings":";;;;;;;AAEA;;AACA;;AAEA;;AAEO,MAAMA,qBAAqB,GAChCC,cADmC,IAGnCC,iBAAWC,MAAX,CAAmBC,CAAD,IAAO;AACvB,iBAAI,aAAJ,EAAmB,mBAAmBH,cAAc,CAACI,IAArD;AACA,QAAMC,YAAY,GAAGL,cAAc,CAACM,OAAf,CAAuB,CAACC,KAAD,EAAQC,CAAR,KAAc;AACxD,QAAID,KAAJ,EAAW;AACT,qBACE,aADF,EAEE,mBAAmBP,cAAc,CAACI,IAAlC,GAAyC,IAAzC,GAAgDG,KAFlD;AAIAJ,MAAAA,CAAC,CAACI,KAAF,CAAQA,KAAR;AACD,KAND,MAMO,IAAI,CAACC,CAAL,EAAQ;AACbL,MAAAA,CAAC,CAACI,KAAF,CACE,IAAIE,sBAAJ,CACE,mCADF,EAEE,2BAFF,CADF;AAMD,KAPM,MAOA;AACL,UAAI;AACF,cAAMC,KAAK,GAAGC,MAAM,CAACC,IAAP,CAAYJ,CAAC,CAACE,KAAd,EAAqB,QAArB,CAAd;AACAP,QAAAA,CAAC,CAACU,IAAF,CAAOH,KAAP;AACD,OAHD,CAGE,OAAOH,KAAP,EAAc;AACdJ,QAAAA,CAAC,CAACI,KAAF,CAAQA,KAAR;AACD;AACF;AACF,GAtBoB,CAArB;AAwBA,SAAO,MAAM;AACX,mBAAI,aAAJ,EAAmB,iBAAiBP,cAAc,CAACI,IAAnD;AACAC,IAAAA,YAAY,CAACS,MAAb;AACD,GAHD;AAID,CA9BD,CAHK","sourcesContent":["// @flow\n\nimport { Observable } from \"rxjs\";\nimport { TransportError } from \"@ledgerhq/errors\";\nimport type { Characteristic } from \"./types\";\nimport { log } from \"@ledgerhq/logs\";\n\nexport const monitorCharacteristic = (\n  characteristic: Characteristic\n): Observable<Buffer> =>\n  Observable.create((o) => {\n    log(\"ble-verbose\", \"start monitor \" + characteristic.uuid);\n    const subscription = characteristic.monitor((error, c) => {\n      if (error) {\n        log(\n          \"ble-verbose\",\n          \"error monitor \" + characteristic.uuid + \": \" + error\n        );\n        o.error(error);\n      } else if (!c) {\n        o.error(\n          new TransportError(\n            \"characteristic monitor null value\",\n            \"CharacteristicMonitorNull\"\n          )\n        );\n      } else {\n        try {\n          const value = Buffer.from(c.value, \"base64\");\n          o.next(value);\n        } catch (error) {\n          o.error(error);\n        }\n      }\n    });\n\n    return () => {\n      log(\"ble-verbose\", \"end monitor \" + characteristic.uuid);\n      subscription.remove();\n    };\n  });\n"],"file":"monitorCharacteristic.js"}